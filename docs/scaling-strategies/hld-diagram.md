# High-Level Design (HLD) Diagram
## Typogram Platform - 1 Million Users

---

## System Architecture Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                         CDN Layer                                │
│                    (CloudFront/Cloudflare)                       │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Edge 1     │  │   Edge 2     │  │   Edge N     │          │
│  │  (Static)    │  │  (Static)    │  │  (Static)    │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Load Balancer                               │
│                    (Nginx/HAProxy)                              │
│              ┌──────────────────────────┐                       │
│              │   Health Checks          │                       │
│              │   SSL Termination        │                       │
│              │   Request Routing        │                       │
│              └──────────────────────────┘                       │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    API Gateway Layer                            │
│                      (Kong/Nginx)                               │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Rate Limiting │ Authentication │ Request Routing        │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                  Application Layer (Kubernetes)                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Auth       │  │   User      │  │   Course     │          │
│  │   Service    │  │   Service   │  │   Service    │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Test       │  │   Analytics  │  │   Payment    │          │
│  │   Service    │  │   Service    │  │   Service    │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Leaderboard│  │   Tournament │  │   Community  │          │
│  │   Service    │  │   Service    │  │   Service     │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│   Redis      │    │    Kafka     │    │   MySQL      │
│   Cluster    │    │   Cluster    │    │   Cluster    │
│              │    │              │    │              │
│  ┌────────┐  │    │  ┌────────┐  │    │  ┌────────┐  │
│  │Master  │  │    │  │Broker1 │  │    │  │Primary │  │
│  └────────┘  │    │  └────────┘  │    │  └────────┘  │
│  ┌────────┐  │    │  ┌────────┐  │    │  ┌────────┐  │
│  │Replica1│  │    │  │Broker2 │  │    │  │Replica1│  │
│  └────────┘  │    │  └────────┘  │    │  └────────┘  │
│  ┌────────┐  │    │  ┌────────┐  │    │  ┌────────┐  │
│  │Replica2│  │    │  │Broker3 │  │    │  │Replica2│  │
│  └────────┘  │    │  └────────┘  │    │  └────────┘  │
└──────────────┘    └──────────────┘    └──────────────┘
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              ▼
                    ┌──────────────┐
                    │   Workers    │
                    │   (Kafka)    │
                    │              │
                    │  ┌────────┐  │
                    │  │Worker1 │  │
                    │  └────────┘  │
                    │  ┌────────┐  │
                    │  │Worker2 │  │
                    │  └────────┘  │
                    │  ┌────────┐  │
                    │  │WorkerN │  │
                    │  └────────┘  │
                    └──────────────┘
                              │
                              ▼
                    ┌──────────────┐
                    │  Object      │
                    │  Storage     │
                    │  (S3/OSS)    │
                    └──────────────┘
```

---

## Component Interaction Flow

### 1. User Registration Flow

```
User → CDN → Load Balancer → API Gateway → Auth Service
                                              │
                                              ▼
                                         MySQL (Write)
                                              │
                                              ▼
                                         Redis (Cache)
                                              │
                                              ▼
                                         Response → User
```

### 2. Typing Test Flow

```
User → API Gateway → Test Service
                      │
                      ├─→ MySQL (Store Test)
                      ├─→ Redis (Cache Test Content)
                      └─→ Response → User
                      
User Completes Test → Test Service
                      │
                      ├─→ Kafka (Async Processing)
                      │     │
                      │     └─→ Workers
                      │           ├─→ Calculate Results
                      │           ├─→ Update Analytics
                      │           └─→ Update Leaderboard
                      │
                      └─→ Immediate Response → User
```

### 3. Real-time Features Flow (Tournaments/Races)

```
User → WebSocket Server → Redis (State)
                           │
                           ├─→ Redis Pub/Sub (Broadcast)
                           └─→ MySQL (Persist)
```

---

## Data Flow Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    User Requests                             │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│              API Gateway (Rate Limiting, Auth)               │
└─────────────────────────────────────────────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
        ▼                   ▼                   ▼
┌──────────────┐   ┌──────────────┐   ┌──────────────┐
│  Synchronous │   │  Asynchronous│   │   Real-time  │
│  Operations │   │  Operations   │   │  Operations  │
└──────────────┘   └──────────────┘   └──────────────┘
        │                   │                   │
        ▼                   ▼                   ▼
┌──────────────┐   ┌──────────────┐   ┌──────────────┐
│  MySQL       │   │  Kafka       │   │  WebSocket   │
│  (Immediate) │   │  (Queue)     │   │  (Live)      │
└──────────────┘   └──────────────┘   └──────────────┘
        │                   │                   │
        │                   ▼                   │
        │           ┌──────────────┐            │
        │           │  Workers    │            │
        │           │  (Process)  │            │
        │           └──────────────┘            │
        │                   │                   │
        └───────────────────┼───────────────────┘
                            ▼
                  ┌──────────────┐
                  │  MySQL       │
                  │  (Persist)   │
                  └──────────────┘
```

---

## Service Decomposition

```
┌─────────────────────────────────────────────────────────────┐
│                    Frontend (React)                           │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │  Web App │  │  Mobile  │  │  Admin   │  │  Public  │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    Backend Services                          │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │              Core Services                            │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐            │  │
│  │  │   Auth  │  │   User   │  │  Course  │            │  │
│  │  └──────────┘  └──────────┘  └──────────┘            │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │            Feature Services                           │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐            │  │
│  │  │   Test  │  │Analytics │  │Payment   │            │  │
│  │  └──────────┘  └──────────┘  └──────────┘            │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │          Real-time Services                          │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐            │  │
│  │  │Tournament│  │   Race   │  │Community │            │  │
│  │  └──────────┘  └──────────┘  └──────────┘            │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
        ▼                   ▼                   ▼
┌──────────────┐   ┌──────────────┐   ┌──────────────┐
│   MySQL      │   │    Redis     │   │    Kafka     │
│   (Data)     │   │   (Cache)    │   │   (Queue)    │
└──────────────┘   └──────────────┘   └──────────────┘
```

---

## Technology Stack

```
┌─────────────────────────────────────────────────────────────┐
│                    Frontend                                  │
│  • React.js                                                  │
│  • WebSocket (Socket.io)                                     │
│  • CDN (CloudFront/Cloudflare)                              │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    Backend                                   │
│  • Spring Boot (Java)                                        │
│  • Kubernetes (Orchestration)                                │
│  • Docker (Containerization)                                │
└─────────────────────────────────────────────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
        ▼                   ▼                   ▼
┌──────────────┐   ┌──────────────┐   ┌──────────────┐
│   MySQL      │   │    Redis     │   │    Kafka     │
│   8.0+       │   │   7.0+       │   │   3.0+       │
└──────────────┘   └──────────────┘   └──────────────┘
```

---

## Network Architecture

```
                    Internet
                       │
                       ▼
            ┌──────────────────┐
            │   DNS (Route53)   │
            └──────────────────┘
                       │
                       ▼
            ┌──────────────────┐
            │   CDN (Edge)     │
            │  • Static Assets │
            │  • API Caching   │
            └──────────────────┘
                       │
                       ▼
            ┌──────────────────┐
            │  Load Balancer   │
            │  • SSL/TLS       │
            │  • Health Checks │
            └──────────────────┘
                       │
                       ▼
            ┌──────────────────┐
            │  API Gateway     │
            │  • Rate Limit    │
            │  • Auth          │
            └──────────────────┘
                       │
        ┌──────────────┼──────────────┐
        │              │              │
        ▼              ▼              ▼
┌──────────┐   ┌──────────┐   ┌──────────┐
│ Service  │   │ Service  │   │ Service │
│  Pod 1   │   │  Pod 2   │   │  Pod N  │
└──────────┘   └──────────┘   └──────────┘
```

---

## Security Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    Security Layers                           │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Layer 1: Network Security                           │  │
│  │  • DDoS Protection (CloudFlare)                     │  │
│  │  • WAF (Web Application Firewall)                   │  │
│  │  • SSL/TLS Encryption                               │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Layer 2: API Security                               │  │
│  │  • Rate Limiting                                     │  │
│  │  • Authentication (JWT)                            │  │
│  │  • Authorization (RBAC)                              │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Layer 3: Application Security                      │  │
│  │  • Input Validation                                 │  │
│  │  • SQL Injection Prevention                         │  │
│  │  • XSS Prevention                                   │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Layer 4: Data Security                             │  │
│  │  • Encryption at Rest                              │  │
│  │  • Encryption in Transit                            │  │
│  │  • Access Control                                   │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

---

## Scalability Architecture

```
┌─────────────────────────────────────────────────────────────┐
│              Horizontal Scaling                              │
│                                                              │
│  Application Layer:                                         │
│  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐        │
│  │ Pod  │  │ Pod  │  │ Pod  │  │ Pod  │  │ Pod  │  ...   │
│  │  1   │  │  2   │  │  3   │  │  4   │  │  N   │        │
│  └──────┘  └──────┘  └──────┘  └──────┘  └──────┘        │
│                                                              │
│  Auto-scaling based on:                                     │
│  • CPU Usage (>70%)                                         │
│  • Memory Usage (>80%)                                      │
│  • Request Rate                                             │
│  • Queue Depth                                              │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│              Vertical Scaling                               │
│                                                              │
│  Database Layer:                                            │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Primary: 16 vCPU, 64GB RAM → 32 vCPU, 128GB RAM    │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  Cache Layer:                                               │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Redis: 16GB RAM → 32GB RAM → 64GB RAM              │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

---

## Monitoring & Observability

```
┌─────────────────────────────────────────────────────────────┐
│              Monitoring Stack                               │
│                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │   Metrics    │  │    Logs      │  │    Traces    │    │
│  │  Prometheus  │  │  ELK Stack   │  │   Jaeger     │    │
│  └──────────────┘  └──────────────┘  └──────────────┘    │
│         │                 │                 │               │
│         └─────────────────┼─────────────────┘               │
│                           ▼                                 │
│                  ┌──────────────┐                          │
│                  │   Grafana    │                          │
│                  │  Dashboards  │                          │
│                  └──────────────┘                          │
│                           │                                 │
│                           ▼                                 │
│                  ┌──────────────┐                          │
│                  │   Alerts     │                          │
│                  │  (PagerDuty) │                          │
│                  └──────────────┘                          │
└─────────────────────────────────────────────────────────────┘
```

---

## Deployment Architecture

```
┌─────────────────────────────────────────────────────────────┐
│              CI/CD Pipeline                                 │
│                                                              │
│  Code → Git → CI (Jenkins/GitHub Actions) → Build → Test  │
│                                                              │
│                           │                                 │
│                           ▼                                 │
│                  Docker Image                               │
│                           │                                 │
│                           ▼                                 │
│              Container Registry (Docker Hub/ECR)            │
│                           │                                 │
│                           ▼                                 │
│              Kubernetes Cluster                            │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                │
│  │  Node 1  │  │  Node 2  │  │  Node N  │                │
│  └──────────┘  └──────────┘  └──────────┘                │
│                                                              │
│  Deployment Strategy:                                       │
│  • Rolling Updates                                          │
│  • Blue-Green Deployment                                    │
│  • Canary Releases                                          │
└─────────────────────────────────────────────────────────────┘
```

---

## Disaster Recovery Architecture

```
┌─────────────────────────────────────────────────────────────┐
│              Primary Region (US-East)                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                │
│  │  MySQL   │  │  Redis   │  │  Kafka   │                │
│  │ Primary  │  │ Master   │  │ Leader   │                │
│  └──────────┘  └──────────┘  └──────────┘                │
│       │              │              │                      │
│       └──────────────┼──────────────┘                      │
│                      │                                      │
│              Async Replication                             │
│                      │                                      │
└──────────────────────┼──────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────┐
│              Secondary Region (US-West)                    │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                │
│  │  MySQL   │  │  Redis   │  │  Kafka   │                │
│  │ Replica  │  │ Replica  │  │ Follower │                │
│  └──────────┘  └──────────┘  └──────────┘                │
│                                                              │
│  Failover: Automatic (RTO: <5 min, RPO: <1 min)           │
└─────────────────────────────────────────────────────────────┘
```

---

## Key Design Principles

1. **Microservices Architecture**: Independent, scalable services
2. **Async Processing**: Non-blocking operations via message queues
3. **Caching Strategy**: Multi-layer caching (CDN → Redis → Application)
4. **Database Optimization**: Read replicas, partitioning, indexing
5. **Horizontal Scaling**: Auto-scaling based on load
6. **High Availability**: Multi-region deployment with failover
7. **Security**: Defense in depth with multiple security layers
8. **Observability**: Comprehensive monitoring and logging

